const root=document.getElementById("m"),b=document.getElementById("b"),s=document.getElementById("s"),h=document.getElementById("help"),X="üëæ",SS="üöÄ",PL="ü™ê";function randomNum(e,t){return e=Math.ceil(e),t=Math.floor(t)+1,Math.floor(Math.random()*(t-e))+e}window.g={t:{},r:{},lvl:{lvl:1},shA:1,blA:1,scA:1,q:2,b:1,mb:1,bb:2,st:120,sRow:4,sRp:4,s:1,tileCount:0,tileSessionCount:0,ani:550,tool:"de",throttle:!1};const g=window.g;class tile{constructor(e){e||(e={row:0});let t={type:e.type?e.type:"?",elm:document.createElement("div"),innerElm:document.createElement("div"),id:window.tileCount,row:e.row||0===e.row?e.row:99,rp:e.rp||0===e.rp?e.rp:99,d:!!e.done&&e.done,b:0,ani:""};return g.tileCount++,g.tileSessionCount++,t.obj=this,t.elm.appendChild(t.innerElm),t.elm.onmousedown=e=>{2!==e.buttons&&"sc"!==g.tool&&(t.elm.classList.add("p"),setTimeout((()=>{t.elm.classList.remove("p")}),g.ani))},t.elm.onmouseup=()=>{t.elm.classList.remove("p")},t.elm.onclick=()=>{this.action(t)},g.r[t.row]?g.r[t.row][t.rp]=t:g.r[t.row]={[t.rp]:t},g.t[Object.keys(g.t).length]=t,randomNum(0,10)>5&&t.elm.setAttribute("m",1),randomNum(0,10)>5&&t.elm.setAttribute("n",2),randomNum(0,10)>5&&t.elm.setAttribute("o",3),t}gainType=(e,t)=>{if("q"!==t)e.type=t;else{let t=randomNum(0,2),l="sc";1===t&&(l="sh"),2===t&&(l="bl"),e.q=l}};destroy=e=>{e.dd=!0,this.dead(e,"d")};action=e=>{let t=!0;if(g.block)return!1;"bl"===g.tool&&g.blA>0&&!e.dd?(this.destroy(e),g.ga("bl",-1)):"sc"===g.tool&&g.scA>0?(this.seeAdjacent(e),g.ga("sc",-1)):"de"===g.tool&&!e.d||"de"===g.tool&&e.q?(e.q&&!e.val&&e.elm.getAttribute("r")&&(g.ga(e.q,1),e.q=!1,e.elm.removeAttribute("q")),e.elm.setAttribute("c","true"),"b"===e.type?(e.innerElm.innerHTML=X,e.obj.ani(e,"b"),this.revealTile(e),g.dmg(-1),t=!1):"?"===e.type&&this.cascade(e)):g.anim(g[g.tool],"g-"),t&&this.postAction(e)};postAction=e=>{setTimeout((()=>{g.up(),g.b>0&&g.blA<1&&warp()}),g.ani),this.cascade(e,!1)};revealTile=e=>{e.elm.setAttribute("r","true");let t="reveal";e.innerElm.classList.add(t),setTimeout((()=>{e.innerElm.classList.remove(t)}),g.ani),g.tilesLeft--};cascade=(e,t,l)=>{let n=this.adjacent(e);this.revealTile(e);let a=0;e.val=0,e.b||e.dd||(e.innerElm.innerHTML="");for(let e=0;e<Object.keys(n).length;e++){let t=n[e];"b"!==t.type||t.dd||a++}if(a>0&&!e.d)e.innerElm.innerHTML=a,e.val=a;else{if("b"===e.type&&!e.dd)return;if(e.q)e.elm.setAttribute("q",e.q);else{if(!t){this.dead(e);for(let t=0;t<Object.keys(n).length;t++)if(!n[t].elm.getAttribute("r")&&!e.dd||n[t].elm.getAttribute("r")&&e.rev||!0===e.dd&&g.b>0&&n[t].val>0&&n[t].elm.getAttribute("r")){n[t].rev=!1;let l=e.dd;this.cascade(n[t],l,l)}}l&&this.dead(e)}}t&&!l&&(e.innerElm.innerHTML="",a>0&&"b"!==e.type?(e.innerElm.innerHTML=a,e.val=a):"b"!==e.type||e.dd||(e.innerElm.innerHTML=X),this.ani(e,"rev"),e.rev=!0)};dead=(e,t)=>{if(t||(t=""),"d"===t){let t={elm:e.elm.cloneNode(!0)};e.elm.appendChild(t.elm),this.ani(t,"deadB",!0),e.innerElm.innerHTML="",e.q=0}this.ani(e,"dead "+t),e.d=!0};seeAdjacent=e=>{let t=this.adjacent(e);this.cascade(e,!0);for(let e=0;e<Object.keys(t).length;e++){let l=t[e];this.cascade(l,!0)}};adjacent=e=>{let t=e.rp,l=e.row,n={},a=e=>{n[Object.keys(n).length]=e};return l-1>=0&&(t-1>=0&&a(g.r[l-1][t-1]),a(g.r[l-1][t]),t+1<g.tr&&a(g.r[l-1][t+1])),t-1>=0&&a(g.r[l][t-1]),t+1<g.tr&&a(g.r[l][t+1]),l+1<g.rows&&(t-1>=0&&a(g.r[l+1][t-1]),a(g.r[l+1][t]),t+1<g.tr&&a(g.r[l+1][t+1])),n};ani=(e,t,l)=>{e.d&&"rev"!==t&&e.d&&"dead d"!==t||(""!==e.ani&&(e.ani="",e.elm.className=""),window.requestAnimationFrame((()=>{"rev"===t&&(t=t+" "+e.ani),e.ani=t,e.elm.className=t,"deadB"===t&&window.requestAnimationFrame((()=>{let t=e.elm.style;t.opacity=.1,t.transform="scale(0.1)"})),setTimeout((()=>{e.d||e.elm.className!==t||(e.elm.className=""),(e.d&&e.elm.classList.contains("rev")||e.dd)&&(e.elm.className="dead "+(e.dd?"d":"")),l&&e.elm.parentNode&&e.elm.parentNode.removeChild(e.elm)}),g.ani)})))}}function ui(){let e=e=>{let t=document.createElement("div");return t.id=e||"",t};g.aid=e("aid"),s.appendChild(g.aid),g.aid.onclick=()=>{h.classList.contains("ninja")?h.className="":h.className="ninja"},g.aid.innerHTML="Help",g.wa=e("wa"),g.wa.appendChild(e("wa2")),g.waN=e("waN"),g.waN.innerHTML="Preparing warp drive",g.wa.appendChild(g.waN),s.appendChild(g.wa),g.sh=e("sh"),g.sh.appendChild(e("sh2")),g.shN=e("shN"),g.sh.appendChild(g.shN),s.appendChild(g.sh),g.mi=e("mi"),g.ss=e("ss"),g.ss.innerHTML=SS,g.pl=e("pl"),g.pl.innerHTML=PL,g.mi.appendChild(g.ss),g.mi.appendChild(e("mp")),g.mi.appendChild(g.pl),s.appendChild(g.mi),g.de=e("de"),g.de.className="s",g.de.innerHTML="<div>‚àû</div>",g.de.onclick=()=>{g.tswp("de")},b.appendChild(g.de),g.bl=e("bl"),g.blN=e("blN"),g.bl.appendChild(g.blN),g.bl.onclick=()=>{g.tswp("bl")},b.appendChild(g.bl),g.sc=e("sc"),g.scN=e("scN"),g.sc.appendChild(g.scN),g.sc.onclick=()=>{g.tswp("sc")},b.appendChild(g.sc),g.al=e("al"),s.appendChild(g.al),g.dmg=e=>(e<0&&(g.sh.style.backgroundColor="var(--d)",g.waN.innerHTML="Shield down",g.anim(document.body,"hit"),setTimeout((()=>{g.sh.style.backgroundColor="var(--m)"}),g.ani)),e<0&&Math.abs(e)>g.shA?(g.shA--,end(),!1):(g.shA=g.shA+e,g.shA>3&&(g.shA=3),updateOverlay(),!0)),g.tswp=e=>{g.sc.className="",g.de.className="",g.bl.className="",e||(e="de"===g.tool?"bl":"bl"===g.tool?"sc":"de"),g[e].className="s",g.tool=e},g.anim=(e,t)=>{e.classList.add(t),setTimeout((()=>{e.classList.remove(t)}),g.ani)},g.ga=(e,t)=>{g.anim(g[e],t<0?"g-":"gg"),g[e+"N"].innerHTML=(t>0?" +":" ")+t,g[e+"A"]+=t,g.scA>3&&(g.scA=3)};let t=e=>"<br>"+e+".<br>";h.innerHTML="üöÄ needs to reach ü™ê to win.<br>",h.innerHTML+=t("Use ‚õè to reveal meteoroids and collect loot, don't click üëæ or you lose shield"),h.innerHTML+=t("Use ‚öî to destroy hostile üëæ use wisely as you barely have enough each round"),h.innerHTML+=t("Use ‚óç to reveal a meteor and all adjacent meteoroids"),h.innerHTML+=t("A number on a revealed meteor indicates how many adjacent üëæ it has"),h.innerHTML+=t("Warping will make you lose shields equal to the number of üëæ left"),h.innerHTML+=t("<br> PC Tips: Right click to cycle tools and use browser-zoom to adjust optimal size")}function updateOverlay(){g.sh.className="sh"+g.shA,g.scN.innerHTML=g.scA,g.blN.innerHTML=g.blA,g.shN.innerHTML="","de"!=g.tool&&g[g.tool+"A"]<=0&&g.tswp("de");let e=0;for(let t=0;t<Object.keys(g.t).length;t++){let l=g.t[t];"b"!==l.type||l.dd||e++}g.b=e,g.al.innerHTML=g.b+" "+X,g.b<1&&(g.al.innerHTML="",warp())}function end(e){if(g.block=!0,g.ex)return;g.ex=!0,clearInterval(g.loop),setTimeout((()=>{t()}),g.ani);let t=()=>{let t=root.cloneNode(!0);t.id="mC",t.className="z0",root.parentNode.appendChild(t),e?(g.lvl.lvl++,setTimeout((()=>{document.getElementById("m2").className="tron";for(let e=0;e<t.getElementsByTagName("div").length;e++){let l=t.getElementsByTagName("div")[e];l.parentNode&&"row"===l.parentNode.className&&(l.style.backgroundColor="var(--g)",l.style.top=randomNum(-500,500)+"px",l.style.left=randomNum(-500,500)+"px",l.style.transform="rotate3d(1, 1, 1, "+randomNum(-360,360)+"deg)")}t.className="",setTimeout((()=>{if(g.lvl.lvl<6)newGame(g.lvl);else{reset(),h.innerHTML="YOU WIN!<br><br>";let e=10*g.scA+5*g.blA+20*g.shA;h.classList="win";let t=localStorage.getItem("score");t?t<e?(h.innerHTML+="<br> NEW HIGHSCORE - "+e,localStorage.setItem("score",e)):h.innerHTML+="<br>Score: "+e:(h.innerHTML+="<br>Score: "+e,localStorage.setItem("score",e)),h.innerHTML+="<br>Highscore "+(t||"none"),h.innerHTML+="<br><p id='again'>Play again?</p>",document.getElementById("again").onclick=()=>{location.reload()},g.ss.style.transform+=" scale(0.1) rotate(160deg)"}setTimeout((()=>{document.getElementById("m2").className="",t.parentNode.removeChild(t)}),g.ani)}),g.ani)}),1)):(g.waN.innerHTML="Ship exploded",g.ss.style.transform="translate(0px, 50px) rotate3d(1, 1, 1, 240deg)",setTimeout((()=>{root.innerHTML="";for(let e=0;e<t.getElementsByTagName("div").length;e++){let l=t.getElementsByTagName("div")[e];l.parentNode&&"row"===l.parentNode.className&&(l.style.left=randomNum(-150,150)+"px",l.style.top=randomNum(450,1050)+"px",l.style.transform="rotate3d(1, 1, 1, "+randomNum(-360,360)+"deg)",l.style.backgroundColor="var(--r)")}t.className="",setTimeout((()=>{t.parentNode.removeChild(t),g.lvl={lvl:1},g.shA=1,g.blA=1,g.scA=2,newGame(g.lvl)}),2*g.ani)}),2*g.ani))}}function reset(){clearInterval(g.loop),root.innerHTML="",g.tileSessionCount=0,g.t={},g.r={},g.tL=0,g.block=!1,g.wa.style.setProperty("--w","0px"),g.al.innerHTML="",g.tswp("de")}function warp(){g.block=!0,g.wa.style.setProperty("--w","200px"),g.waN.innerHTML="Warping Successful";for(let e=0;e<g.b&&g.dmg(-1);e++);g.shA>-1&&end(!0)}function newGame(e){e||(e={lvl:1}),reset(),g.mi.classList.add("lvl"+e.lvl),g.ss.style.transform="translate("+45*(e.lvl-1)+"px, 0px) rotate(30deg)";let t=g.st+10*e.lvl;g.timer=t,g.tL=t,g.loop=setInterval((()=>{g.tL--;let e=200-g.timer/100*g.tL*2;g.wa.style.setProperty("--w",(e<0?0:e)+"px"),g.waN.innerHTML="Warping in "+g.tL,g.tL<=0&&warp()}),1e3);const l=e.rows?e.rows:g.sRow+g.lvl.lvl,n=e.tr?e.tr:g.sRp+g.lvl.lvl;g.mb=e.b?e.b:g.bb+g.lvl.lvl,g.tr=n,g.rows=l;for(let e=0;e<l;e++){let t=document.createElement("div");t.className="row";for(let l=0;l<n;l++){let n=new tile({row:e,rp:l});t.appendChild(n.elm)}root.appendChild(t)}nB=0;for(let e=0;e<g.mb;e++){let e=randomNum(0,Object.keys(g.t).length-1),t=g.t[e];"b"===t.type?nB--:t.obj.gainType(t,"b")}for(let e=0;e<g.q;e++){let e=randomNum(0,Object.keys(g.t).length-1),t=g.t[e];"?"===t.type&&t.obj.gainType(t,"q")}g.b=g.mb-nB,g.ga("bl",g.b),setTimeout((()=>{document.body.className="",g.ex=!1}),1),g.up()}g.boot=()=>{ui(),g.newGame=newGame,g.up=updateOverlay,g.end=end,setTimeout((()=>{newGame()}),g.ani),document.body.oncontextmenu=e=>{e.preventDefault(),g.tswp()},setTimeout((()=>{document.monetization&&document.monetization.state&&(console.log("coil active get free scan"),g.ga("sc",1))}),g.ani)};
